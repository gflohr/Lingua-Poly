openapi: '3.0.2'
info:
  title: 'Lingua::Poly OpenAPI WebApp'
  version:  '1.0'
servers:
  - url: http://127.0.0.1:4200/api/lingua-poly/v1
    description: The development server
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: MOJOSID
  schemas:
    DefaultResponse:
      title: DefaultResponse
      description: Generic default response
      properties:
        errors:
          type: array
          items:
            properties:
              message:
                type: string
              path:
                type: string
            required:
            - message
            - path
      required:
      - errors
      - status
    User:
      title: User
      description: A user object is identified by its username, its email or both.
      properties:
        email:
          type: string
          minLength: 3
          example: john.doe@acme.com
        username:
          type: string
          minLength: 2
          example: JohnDoe
    UserDraft:
      title: UserDraft
      properties:
        email:
          type: string
          minLength: 3
          example: john.doe@acme.com
        password:
          type: string
          minLength: 1
          example: s3cr3t
      required:
      - email
      - password
      additionalProperties: false
    Token:
      title: Token
      properties:
        token:
          type: string
          example: abcdef
      required:
        - token
      additionalProperties: false
  requestBodies:
    CreateUserRequest:
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserDraft"
    Token:
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Token"
tags:
  - name: users
    description: User management
paths:
  /users:
    post:
      tags:
      - users
      summary: Create a new user
      x-mojo-to: 'user#create'
      operationId: usersPost
      requestBody:
        $ref: "#/components/requestBodies/CreateUserRequest"
      responses:
        201:
          description: User waiting for confirmation created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        default:
          description: Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DefaultResponse'
  /register:
    post:
      tags:
      - users
      summary: Confirm a registration
      x-mojo-to: 'user#confirmRegistration'
      operationId: register
      requestBody:
        $ref: '#/components/requestBodies/Token'
      responses:
        200:
          description: User activated after confirmation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        default:
          description: Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DefaultResponse'
      
